<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright(c) 2022 TechSureCo.,Ltd.AllRightsReserved.
  ~ 本内容仅限于深圳市赞悦科技有限公司内部传阅，禁止外泄以及用于其他的商业项目。
  -->

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="codedriver.module.deploy.dao.mapper.DeployCiMapper">

    <select id="checkDeployCiIsRepeat" parameterType="codedriver.framework.deploy.dto.ci.DeployCiVo" resultType="java.lang.Integer">
        select count(1) from deploy_ci where `id` != #{id} and `name` = #{name}
    </select>

    <insert id="insertDeployCi" parameterType="codedriver.framework.deploy.dto.ci.DeployCiVo">
        insert into deploy_ci (
            `id`,
            `name`,
            `is_active`,
            `app_system_id`,
            `app_module_id`,
            `repo_type`,
            `repo_server_address`,
            `repo_name`,
            `branches`,
            `event`,
            `action`,
            `trigger_type`,
            `trigger_time`,
            `version_rule`,
            `config`
        ) values (
            #{id},
            #{name},
            #{isActive},
            #{appSystemId},
            #{appModuleId},
            #{repoType},
            #{repoServerAddress},
            #{repoName},
            #{branchesStr},
            #{event},
            #{action},
            #{triggerType},
            #{triggerTime},
            #{versionRuleStr},
            #{configStr}
        ) ON DUPLICATE KEY UPDATE
            `name` = #{name},
            `is_active` = #{isActive},
            `app_system_id` = #{appSystemId},
            `app_module_id` = #{appModuleId},
            `repo_type` = #{repoType},
            `repo_server_address` = #{repoServerAddress},
            `repo_name` = #{repoName},
            `branches` = #{branchesStr},
            `event` = #{event},
            `action` = #{action},
            `trigger_type` = #{triggerType},
            `trigger_time` = #{triggerTime},
            `version_rule` = #{versionRuleStr},
            `config` = #{configStr}
    </insert>

</mapper>